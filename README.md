---
layout: default
title: "Homework 9: Facebook Lite"
permalink: /homeworks/homework9/
---

# Homework 9: Facebook Lite
Due **March 28, 2016**.

The assignment is available for download [here](cis196_homework_9.zip).

## Before Starting
Be sure to review lectures [7](/~cis196/lectures/lecture7.html), [8](/~cis196/lectures/lecture8.html), and [9](/~cis196/lectures/lecture9.html).

## Task
In this homework, you will implement a subset of Facebook's features, namely the
ability to sign up, log in, log out, post statuses, join, and leave groups.

## Models
You will need `User`, `Group`, `GroupsUser`, and `Status` models, which I
recommend making with the built in generators in Rails. Furthermore, I recommend
generating scaffolds for `User` and `Group` since you will implement all the
CRUD operations for those models.

### User
In the `User` model, you will also have to
`include BCrypt` and copy the `password` and `password=` methods from its
[documentation](https://github.com/codahale/bcrypt-ruby){:target="\_blank"}. You
will have to modify the `password` method to be able to handle a `nil`
password\_hash.

## Migrations
These should have been generated with your model, but if not, you can generate them
separately. The `users` table should have name, email, and password\_hash columns, the
`statuses` table should have text and a user\_id column, the `groups` table
should have a name column, and the `groups_users` table should have user\_id and
group\_id columns.

## Associations
Make sure a user can have many statuses and groups, groups can have many
users, GroupsUser belongs to user and groups, and a status belongs to a user.

## Validations
You will have to create a few validations. For `Group`, you will only have to
check that it has a name. For `Status`, you will have to make sure there is
text, and it is at least 5 characters long. For `User`, you will need to make
sure the name is present, unique, and has a minimum length of 2 characters. You
will also have to make sure its email and password are present. Finally, you
will have to write your own custom validation, making sure the name is
capitalized. If it's not, add an error to `name` with the message 'name is not
capitalized'.

## Controllers

### WelcomeController
You can generate this with the built-in `rails g`, or you can create it
yourself. This controller should manage the root page (i.e. '/') with an `index`
method. The `welcome/index.html.erb` file should be rendered.

### UsersController
This should already be generated by your scaffolding, but in case it wasn't,
make sure you support the 7 RESTful routes. Make sure to clear the session when
you delete a user by calling the `reset_session` method, and make sure to log in
as the newly created user after signing up.

### GroupsController
This should also already be generated by your scaffolding, but in case it wasn't,
make sure you support the 7 RESTful routes. It should also support an `add_user`
method, which will get called from a POST request to `/groups/:id/users`. In
this method, you will add the `current_user` to the group unless he's already in
the group. Redirect to the group's show page. Finally, it should support a
`delete_user` method, which will get called from a DELETE request to
`/groups/:id/users`. In this method, remove the `current_user` from the group
and then redirect to the group's show page.

### ApplicationController
You should define two helper methods called `logged_in?` and `current_user`.
`logged_in?` should tell you if a user is logged in, and `current_user` should
return the instance of the logged in user.

### SessionsController
This can also be generated by `rails g`. It should support `new`, `create`, and
`destroy`. The `new` route should render the `sessions/login`
page, the `create` route should log the user in (i.e. assign the session's
`user_id`), and the `destroy` route should log the user out. Just use the
`reset_session` method and then redirect to the root page.

### StatusesController
This can also be generated by `rails g`. It should support the `new`, `create`,
`edit`, and `destroy` routes. Since only a logged in user should be able to post
statuses for himself, use the `current_user` as the user the status belongs to.

## Routes
This should all be in the `config/routes.rb` file. Make the `WelcomeController`'s
`index` method the root. Add the 7 RESTful routes for `group` and `user` with
the `resources` method. Also, make a POST request to `/groups/:id/users`
correspond to the `GroupsController`'s `add_user` method and a DELETE request to
`/groups/:id/users` to the `delete_user` method. Make a GET request to `/login`
correspond to the `SessionsController`'s `new` method, a POST request to
`/login` to its `create` method, and a DELETE request to `/logout` to its
`destroy` method. Finally, only create the RESTful routes for `status` for
`new`, `create`, `edit`, `update`, and `destroy`.

## Views
Note that when invalid data are submitted and error messages are displayed, the
url will change to the index route (e.g. submit to `/groups/new` will redirect
to `/groups` even though the page is still on the new page). This is expected
behavior.

### application.html.erb
If you look at this file, you'll notice that it references the `nav` partial. In
the corresponding file (i.e. `_nav.html.erb`), you will have to add a Log in
link (the text says 'Log in' to the '/login' route) and a Sign up link (the text
says 'Sign up' to the '/users/new' route) if the user is not logged in. If the
user is logged in, you should add a link with the current user's name to its
show page and a log out link (the text says 'Log out' with a DELETE request to
'/logout').

### Welcome
The homepage should be the `welcome/index.html.erb` page, and if a user is
logged in, it should say 'Hi `current_user.name`'.

### Log In
For log in, you will have to render the `sessions/new.html.erb` page, which should have a
form (I recommend using `form_tag`) to send a POST request to `/login`. The user
should only have to put in a name and password. Rename the button to say 'Log in'.

### User

#### Sign Up
For signing up, use the `users/new.html.erb` file. For the form, you can just
ask for name, email, and password. Make sure to display error messages if there
are any.

#### Index
Make sure not to list every user's password on this page. Plus, only display the
'Edit' and 'Destroy' buttons for yourself if you're logged in (so at most only
one user should have the 'Edit' and 'Destroy' buttons displayed).

#### Show
Similarly, in the `users/show.html.erb` file, only display the 'edit' button if
that is your page, and you are logged in. You should also display all the user's
statuses but only display their 'edit' and 'destroy' buttons if it is the logged
in user's page. You don't want just anyone to be able to edit and delete your
statuses. Finally, if it is the logged in user's page, there should also be a
link called 'New Status' that goes to the new status form page, an 'Edit' link
to its edit page, and a 'Destroy' link that will delete it.

#### Status
You will only need new and edit status pages, which also display errors if there
are any. You will only need a `text_area` field for the status's text.

### Group

#### New, Edit, Index
These can be kept exactly the same as when they were scaffolded.

#### Show
List all the group's users and if you are logged in, display a 'Join' button and
a 'Leave' button. The 'Join' button should send a POST request to the
'/groups/`@group.id`/users' route, and the 'Leave' button should send a DELETE
request to the '/groups/`@group.id`/users' route.

## Uploading
Just run `rake zip` to generate the files.zip file you should upload.
